<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G9Tool Dashboard - ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ Dashboard ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
    .header, main {
      max-width: 700px;
      margin: auto;
    }
    main {
      padding: 20px;
      background: #1c1c1c;
      border-radius: 12px;
      margin-top: 20px;
    }
    .form-wrapper input,
    .form-wrapper textarea {
      margin-bottom: 12px;
    }
    .btn-group {
      margin-top: 12px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-group button {
      flex: 1 1 150px;
    }
    #productList {
      margin-top: 25px;
      max-height: 350px;
      overflow-y: auto;
      background: #2a2a2a;
      border-radius: 10px;
      padding: 10px;
    }
    .product-item {
      background: #1e1e1e;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .product-item:hover {
      background: #333;
    }
    .product-info {
      flex: 1;
      color: #ddd;
      font-size: 14px;
      overflow-wrap: anywhere;
    }
    .product-actions button {
      background: #dc3545;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.3s;
    }
    .product-actions button:hover {
      background: #b02a37;
    }
    #searchInput {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      margin-bottom: 15px;
      font-size: 15px;
      background: #2a2a2a;
      color: white;
    }
    /* Scrollbar Styling */
    #productList::-webkit-scrollbar {
      width: 8px;
    }
    #productList::-webkit-scrollbar-track {
      background: #1c1c1c;
      border-radius: 8px;
    }
    #productList::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 8px;
    }
    /* Responsive */
    @media (max-width: 480px) {
      .product-item {
        flex-direction: column;
        align-items: flex-start;
      }
      .product-actions {
        margin-top: 8px;
        width: 100%;
        display: flex;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>

<header class="header">
  <div class="left-icons">
    <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
    <div class="logo"><i class="fas fa-box-open"></i> G9Tool</div>
  </div>
  <a href="https://t.me/G9tool" class="telegram-icon" target="_blank">
    <i class="fab fa-telegram-plane"></i>
  </a>
</header>

<main>
  <h2 style="text-align:center; margin-bottom: 20px;">üõ†Ô∏è ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶æ‡¶∞</h2>

  <input type="text" id="searchInput" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®... (‡¶®‡¶æ‡¶Æ, ‡¶ï‡ßã‡¶°, ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø)" />

  <div class="form-wrapper">
    <input type="hidden" id="editIndex" value="-1" />
    <input type="text" id="name" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ *" required />
    <input type="text" id="code" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶ï‡ßã‡¶° *" required />
    <input type="number" id="price" placeholder="‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥) *" required />
    <input type="number" id="offer" placeholder="‡¶Ö‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)" />
    <input type="text" id="unit" placeholder="‡¶á‡¶â‡¶®‡¶ø‡¶ü (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶™‡¶ø‡¶∏, ‡¶ï‡ßá‡¶ú‡¶ø)" />
    <input type="number" id="qty" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (Qty)" />
    <input type="text" id="brand" placeholder="‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° / ‡¶ï‡ßã‡¶Æ‡ßç‡¶™‡¶æ‡¶®‡¶ø" />
    <input type="text" id="size" placeholder="‡¶∏‡¶æ‡¶á‡¶ú ‡¶Ö‡¶™‡¶∂‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: S, M, L)" />
    <input type="text" id="color" placeholder="‡¶∞‡¶ô ‡¶Ö‡¶™‡¶∂‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶≤‡¶æ‡¶≤, ‡¶∏‡¶¨‡ßÅ‡¶ú)" />
    <input type="text" id="delivery" placeholder="‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ü‡¶æ‡¶á‡¶Æ" />
    <input type="text" id="status" placeholder="‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏" />
    <input type="text" id="category" placeholder="‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø" />
    <textarea id="desc" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ"></textarea>

    <div id="imageInputs">
      <input type="url" class="img-url" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (Image URL)" />
    </div>
    <button type="button" onclick="addImageInput()">
      <i class="fas fa-plus"></i> ‡¶Ü‡¶∞‡¶ì ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
    </button>

    <input type="url" id="video" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï (YouTube)" />
    <input type="text" id="wa" placeholder="WhatsApp ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ (8801XXXXXXXXXX) *" required />

    <h4 style="margin-top: 20px;">üîß ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶§‡¶•‡ßç‡¶Ø (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ø, ‡¶â‡ßé‡¶™‡¶æ‡¶¶‡¶® ‡¶¶‡ßá‡¶∂)</h4>
    <div id="customFields">
      <div class="custom-field-group">
        <input type="text" class="custom-key" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ø" />
        <input type="text" class="custom-value" placeholder="‡¶Æ‡¶æ‡¶® ‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß© ‡¶Æ‡¶æ‡¶∏" />
      </div>
    </div>
    <button type="button" onclick="addCustomField()">
      <i class="fas fa-plus"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
    </button>

    <div class="btn-group">
      <button id="saveBtn"><i class="fas fa-save"></i> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
      <button id="clearBtn" style="background:#dc3545;"><i class="fas fa-trash"></i> ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
    </div>
  </div>

  <h3 style="margin-top: 40px; text-align:center;">üìù ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h3>
  <div id="productList" aria-live="polite" aria-atomic="true" aria-relevant="all"></div>

  <div class="btn-group" style="margin-top: 30px;">
    <button id="exportBtn" style="background:#007bff;"><i class="fas fa-file-export"></i> ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü JSON</button>
    <button id="importBtn" style="background:#ffc107; color:#000;"><i class="fas fa-file-import"></i> ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü JSON</button>
    <input type="file" id="importFile" accept=".json" style="display:none" />
  </div>
</main>

<div id="sidebar" class="sidebar">
  <button class="close-sidebar" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
  <a href="dashboard.html"><i class="fas fa-home"></i> ‡¶π‡ßã‡¶Æ</a>
  <a href="menu/about.html"><i class="fas fa-info-circle"></i> ‡¶è‡¶¨‡¶æ‡¶â‡¶ü</a>
  <a href="menu/contact.html"><i class="fas fa-phone"></i> ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü</a>
  <a href="menu/privacy.html"><i class="fas fa-user-shield"></i> ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø</a>
  <a href="menu/tutorial.html"><i class="fas fa-graduation-cap"></i> ‡¶ü‡¶ø‡¶â‡¶ü‡ßã‡¶∞‡¶ø‡ßü‡¶æ‡¶≤</a>
  <a href="index.html" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a>
</div>

<script>
  // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï
  if (!localStorage.getItem("loggedInUser")) {
    alert("‚ö†Ô∏è ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
    window.location.href = "index.html";
  }

  const username = localStorage.getItem("loggedInUser");

  // ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶°‡ßá‡¶ü‡¶æ localStorage key
  const storageKey = `products_${username}`;

  // ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
  const productListEl = document.getElementById("productList");
  const searchInput = document.getElementById("searchInput");
  const saveBtn = document.getElementById("saveBtn");
  const clearBtn = document.getElementById("clearBtn");
  const importBtn = document.getElementById("importBtn");
  const exportBtn = document.getElementById("exportBtn");
  const importFileInput = document.getElementById("importFile");

  // ‡¶´‡¶∞‡ßç‡¶Æ ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶∏
  const editIndexEl = document.getElementById("editIndex");
  const nameEl = document.getElementById("name");
  const codeEl = document.getElementById("code");
  const priceEl = document.getElementById("price");
  const offerEl = document.getElementById("offer");
  const unitEl = document.getElementById("unit");
  const qtyEl = document.getElementById("qty");
  const brandEl = document.getElementById("brand");
  const sizeEl = document.getElementById("size");
  const colorEl = document.getElementById("color");
  const deliveryEl = document.getElementById("delivery");
  const statusEl = document.getElementById("status");
  const categoryEl = document.getElementById("category");
  const descEl = document.getElementById("desc");
  const videoEl = document.getElementById("video");
  const waEl = document.getElementById("wa");
  const imageInputsContainer = document.getElementById("imageInputs");
  const customFieldsContainer = document.getElementById("customFields");

  // Load products from localStorage
  function loadProducts() {
    const data = localStorage.getItem(storageKey);
    if (!data) return [];
    try {
      return JSON.parse(data);
    } catch {
      return [];
    }
  }

  // Save products to localStorage
  function saveProducts(products) {
    localStorage.setItem(storageKey, JSON.stringify(products));
  }

  // Clear form inputs
  function clearForm() {
    editIndexEl.value = -1;
    nameEl.value = "";
    codeEl.value = "";
    priceEl.value = "";
    offerEl.value = "";
    unitEl.value = "";
    qtyEl.value = "";
    brandEl.value = "";
    sizeEl.value = "";
    colorEl.value = "";
    deliveryEl.value = "";
    statusEl.value = "";
    categoryEl.value = "";
    descEl.value = "";
    videoEl.value = "";
    waEl.value = "";
    // Clear image inputs except first one
    imageInputsContainer.innerHTML = '<input type="url" class="img-url" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (Image URL)" />';
    // Clear custom fields except one
    customFieldsContainer.innerHTML = `
      <div class="custom-field-group">
        <input type="text" class="custom-key" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ø" />
        <input type="text" class="custom-value" placeholder="‡¶Æ‡¶æ‡¶® ‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß© ‡¶Æ‡¶æ‡¶∏" />
      </div>
    `;
  }

  // Render product list with optional filter
  function renderProducts(filter = "") {
    const products = loadProducts();
    productListEl.innerHTML = "";

    let filtered = products;
    if (filter.trim()) {
      const lowerFilter = filter.toLowerCase();
      filtered = products.filter(p => 
        (p.name && p.name.toLowerCase().includes(lowerFilter)) ||
        (p.code && p.code.toLowerCase().includes(lowerFilter)) ||
        (p.category && p.category.toLowerCase().includes(lowerFilter))
      );
    }

    if (filtered.length === 0) {
      productListEl.innerHTML = `<p style="text-align:center;color:#888;">‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>`;
      return;
    }

    filtered.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "product-item";
      div.setAttribute("data-index", i);

      div.innerHTML = `
        <div class="product-info">
          <strong>${p.name || "-"}</strong> | ‡¶ï‡ßã‡¶°: ${p.code || "-"} | ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø: ${p.category || "-"} | ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${p.price || "0"}
        </div>
        <div class="product-actions">
          <button onclick="editProduct(${i}); event.stopPropagation();" title="‡¶è‡¶°‡¶ø‡¶ü"><i class="fas fa-edit"></i></button>
          <button onclick="deleteProduct(${i}); event.stopPropagation();" title="‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®"><i class="fas fa-trash"></i></button>
        </div>
      `;

      // ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶°‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
      div.addEventListener("click", () => {
        editProduct(i);
      });

      productListEl.appendChild(div);
    });
  }

  // Add image input (Dashboard)
  function addImageInput() {
    const inputs = imageInputsContainer.querySelectorAll(".img-url");
    if (inputs.length >= 5) return;
    const input = document.createElement("input");
    input.type = "url";
    input.className = "img-url";
    input.placeholder = "‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (Image URL)";
    imageInputsContainer.appendChild(input);
  }

  // Add custom field input
  function addCustomField() {
    const group = document.createElement("div");
    group.className = "custom-field-group";
    group.innerHTML = `
      <input type="text" class="custom-key" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ø" />
      <input type="text" class="custom-value" placeholder="‡¶Æ‡¶æ‡¶® ‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß© ‡¶Æ‡¶æ‡¶∏" />
    `;
    customFieldsContainer.appendChild(group);
  }

  // Save or update product
  function saveProduct() {
    const name = nameEl.value.trim();
    const code = codeEl.value.trim();
    const price = parseFloat(priceEl.value);
    const offer = parseFloat(offerEl.value);
    const unit = unitEl.value.trim();
    const qty = parseFloat(qtyEl.value);
    const brand = brandEl.value.trim();
    const size = sizeEl.value.trim();
    const color = colorEl.value.trim();
    const delivery = deliveryEl.value.trim();
    const status = statusEl.value.trim();
    const category = categoryEl.value.trim();
    const desc = descEl.value.trim();
    const video = videoEl.value.trim();
    const wa = waEl.value.trim();

    const imgs = Array.from(imageInputsContainer.querySelectorAll(".img-url")).map(i => i.value.trim()).filter(Boolean);

    const customFields = Array.from(customFieldsContainer.querySelectorAll(".custom-field-group")).map(group => {
      return {
        key: group.querySelector(".custom-key").value.trim(),
        value: group.querySelector(".custom-value").value.trim()
      };
    }).filter(f => f.key && f.value);

    if (!name || !code || isNaN(price) || imgs.length === 0 || !wa) {
      alert("‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡¶æ‡¶Æ, ‡¶ï‡ßã‡¶°, ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶∏, ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø ‡¶è‡¶¨‡¶Ç WhatsApp ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¨‡¶æ‡¶ß‡ßç‡¶Ø‡¶§‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï‡•§");
      return;
    }

    let products = loadProducts();

    const productObj = {
      name, code, price, offer, unit, qty, brand, size, color, delivery, status, category, desc, video, wa, imgs, customFields
    };

    const editIndex = parseInt(editIndexEl.value);
    if (editIndex >= 0) {
      // Update existing product
      products[editIndex] = productObj;
      alert("‚úÖ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    } else {
      // Add new product
      products.push(productObj);
      alert("‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    saveProducts(products);
    renderProducts(searchInput.value);
    clearForm();
  }

  // Edit product (fill form)
  function editProduct(index) {
    const products = loadProducts();
    if (!products[index]) return;

    const p = products[index];

    editIndexEl.value = index;
    nameEl.value = p.name || "";
    codeEl.value = p.code || "";
    priceEl.value = p.price || "";
    offerEl.value = p.offer || "";
    unitEl.value = p.unit || "";
    qtyEl.value = p.qty || "";
    brandEl.value = p.brand || "";
    sizeEl.value = p.size || "";
    colorEl.value = p.color || "";
    deliveryEl.value = p.delivery || "";
    statusEl.value = p.status || "";
    categoryEl.value = p.category || "";
    descEl.value = p.desc || "";
    videoEl.value = p.video || "";
    waEl.value = p.wa || "";

    // Load images
    imageInputsContainer.innerHTML = "";
    if (p.imgs && p.imgs.length > 0) {
      p.imgs.forEach(url => {
        const input = document.createElement("input");
        input.type = "url";
        input.className = "img-url";
        input.placeholder = "‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï (Image URL)";
        input.value = url;
        imageInputsContainer.appendChild(input);
      });
    } else {
      addImageInput();
    }

    // Load custom fields
    customFieldsContainer.innerHTML = "";
    if (p.customFields && p.customFields.length > 0) {
      p.customFields.forEach(f => {
        const group = document.createElement("div");
        group.className = "custom-field-group";
        group.innerHTML = `
          <input type="text" class="custom-key" placeholder="‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶ì‡ßü‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶ü‡¶ø" value="${f.key}" />
          <input type="text" class="custom-value" placeholder="‡¶Æ‡¶æ‡¶® ‡¶Ø‡ßá‡¶Æ‡¶®: ‡ß© ‡¶Æ‡¶æ‡¶∏" value="${f.value}" />
        `;
        customFieldsContainer.appendChild(group);
      });
    } else {
      addCustomField();
    }
  }

  // Delete product
  function deleteProduct(index) {
    if (!confirm("‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
    let products = loadProducts();
    products.splice(index, 1);
    saveProducts(products);
    renderProducts(searchInput.value);
    clearForm();
  }

  // Search event
  searchInput.addEventListener("input", () => {
    renderProducts(searchInput.value);
  });

  // Save button event
  saveBtn.addEventListener("click", () => {
    saveProduct();
  });

  // Clear form button event
  clearBtn.addEventListener("click", () => {
    clearForm();
  });

  // Export JSON
  exportBtn.addEventListener("click", () => {
    const products = loadProducts();
    if (products.length === 0) {
      alert("‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø‡•§");
      return;
    }
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(products, null, 2));
    const dlAnchor = document.createElement("a");
    dlAnchor.setAttribute("href", dataStr);
    dlAnchor.setAttribute("download", `products_${username}.json`);
    dlAnchor.click();
  });

  // Import JSON
  importBtn.addEventListener("click", () => {
    importFileInput.click();
  });

  importFileInput.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const importedData = JSON.parse(event.target.result);
        if (!Array.isArray(importedData)) {
          alert("‡¶Ö‡¶¨‡ßà‡¶ß ‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü!");
          return;
        }
        localStorage.setItem(storageKey, JSON.stringify(importedData));
        alert("‚úÖ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        renderProducts();
        clearForm();
      } catch {
        alert("‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      }
    };
    reader.readAsText(file);
  });

  // Clear form on page load
  clearForm();
  renderProducts();

  // Sidebar toggle
  function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("active");
  }

  // Logout function
  function logout() {
    if (confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
      localStorage.removeItem("loggedInUser");
      window.location.href = "index.html";
    }
  }

  window.toggleMenu = toggleMenu;
  window.logout = logout;
  window.addImageInput = addImageInput;
  window.addCustomField = addCustomField;
  window.editProduct = editProduct;
  window.deleteProduct = deleteProduct;
</script>

</body>
</html>
