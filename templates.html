<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>G9Tool - আউটপুট টেমপ্লেট</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Custom styles for templates.html */
    .template-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    .template-card {
      background: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    .template-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    .template-preview {
      width: 100%;
      height: 200px;
      background-color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #bbb;
      font-size: 14px;
      overflow: hidden;
      position: relative;
    }
    .template-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
      transform: scale(0.7); /* Scale down for preview */
      transform-origin: top left;
      pointer-events: none; /* Disable interaction */
    }
    .template-info {
      padding: 15px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .template-info h3 {
      margin-top: 0;
      color: #00bfff;
      font-size: 18px;
    }
    .template-info p {
      font-size: 14px;
      color: #ccc;
      margin-bottom: 15px;
      flex-grow: 1;
    }
    .template-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .template-actions button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .apply-btn {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
    }
    .apply-btn:hover {
      background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
    }
    .preview-btn {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
    }
    .preview-btn:hover {
      background: linear-gradient(135deg, #0056b3 0%, #007bff 100%);
    }
    .add-template-btn {
      background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      margin: 20px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    .add-template-btn:hover {
      transform: translateY(-3px);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #1f1f1f;
      margin: auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
      position: relative;
    }
    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-button:hover,
    .close-button:focus {
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    .modal-content h2 {
      color: #00bfff;
      margin-top: 0;
      margin-bottom: 20px;
    }
    .modal-content label {
      display: block;
      margin-bottom: 8px;
      color: #ccc;
    }
    .modal-content input[type="text"],
    .modal-content textarea {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #2a2a2a;
      color: white;
      font-size: 16px;
    }
    .modal-content textarea {
      min-height: 150px;
      resize: vertical;
    }
    .modal-content button {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .modal-content button:hover {
      background: linear-gradient(135deg, #20c997 0%, #28a745 100%);
    }
    .template-preview-modal .modal-content {
      max-width: 80%;
      height: 80%;
      display: flex;
      flex-direction: column;
    }
    .template-preview-modal iframe {
      flex-grow: 1;
      width: 100%;
      border: none;
      background-color: white;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<header class="header">
  <div class="left-icons">
    <button class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
  </div>
  <div class="logo"><i class="fas fa-toolbox"></i> G9Tool Enhanced</div>
  <a class="telegram-icon" href="https://t.me/mehedi_exx" target="_blank"><i class="fab fa-telegram-plane"></i></a>
</header>

<div class="sidebar" id="sidebar">
  <button class="close-sidebar" onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
  <a href="dashboard.html"><i class="fas fa-home"></i> ড্যাশবোর্ড</a>
  <a href="profile.html"><i class="fas fa-user"></i> প্রোফাইল</a>
  <a href="tutorial.html"><i class="fas fa-graduation-cap"></i> টিউটোরিয়াল</a>
  <a href="admin.html"><i class="fas fa-cog"></i> এডমিন প্যানেল</a>
  <a href="templates.html"><i class="fas fa-palette"></i> আউটপুট টেমপ্লেট</a>
  <a href="file manager/Theme.html"><i class="fab fa-blogger-b"></i> ডাউনলোড থিম</a>
  <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> লগ আউট</a>
</div>

<main>
  <button class="add-template-btn" onclick="openTemplateModal()"><i class="fas fa-plus"></i> নতুন টেমপ্লেট যোগ করুন</button>
  <div class="template-grid" id="templateGrid"></div>
</main>

<!-- Add/Edit Template Modal -->
<div id="templateModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeTemplateModal()">&times;</span>
    <h2 id="modalTitle">নতুন টেমপ্লেট যোগ করুন</h2>
    <label for="templateName">টেমপ্লেটের নাম:</label>
    <input type="text" id="templateName" placeholder="টেমপ্লেটের একটি নাম দিন" />
    <label for="templateCode">টেমপ্লেট কোড (HTML):</label>
    <textarea id="templateCode" placeholder="এখানে আপনার HTML টেমপ্লেট কোড লিখুন"></textarea>
    <button onclick="saveTemplate()">সংরক্ষণ করুন</button>
  </div>
</div>

<!-- Template Preview Modal -->
<div id="templatePreviewModal" class="modal template-preview-modal">
  <div class="modal-content">
    <span class="close-button" onclick="closePreviewModal()">&times;</span>
    <h2>টেমপ্লেট প্রিভিউ</h2>
    <iframe id="templatePreviewFrame"></iframe>
  </div>
</div>

<script src="script.js"></script>
<script src="templates.js"></script>
<script>
  let editingTemplateId = null;

  function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("active");
  }

  function logout() {
    if (confirm("আপনি কি লগ আউট করতে চান?")) {
      localStorage.removeItem("loggedInUser");
      window.location.replace("index.html");
    }
  }

  function openTemplateModal(templateId = null) {
    const modal = document.getElementById("templateModal");
    const modalTitle = document.getElementById("modalTitle");
    const templateNameInput = document.getElementById("templateName");
    const templateCodeTextarea = document.getElementById("templateCode");

    editingTemplateId = templateId;

    if (templateId) {
      modalTitle.textContent = "টেমপ্লেট এডিট করুন";
      // Get templates from localStorage first, then fallback to predefined
      let templates = JSON.parse(localStorage.getItem("customOutputTemplates") || "[]");
      const predefinedTemplates = getOutputTemplates(); // From templates.js
      templates = [...predefinedTemplates, ...templates];

      const template = templates.find(t => t.id == templateId);
      if (template) {
        templateNameInput.value = template.name;
        templateCodeTextarea.value = template.html; // Use .html for predefined, .code for custom
      }
    } else {
      modalTitle.textContent = "নতুন টেমপ্লেট যোগ করুন";
      templateNameInput.value = "";
      templateCodeTextarea.value = "";
    }
    modal.style.display = "flex";
  }

  function closeTemplateModal() {
    document.getElementById("templateModal").style.display = "none";
    editingTemplateId = null;
  }

  function saveTemplate() {
    const templateName = document.getElementById("templateName").value.trim();
    const templateCode = document.getElementById("templateCode").value.trim();

    if (!templateName || !templateCode) {
      showToast("টেমপ্লেটের নাম এবং কোড উভয়ই প্রয়োজন।", "error");
      return;
    }

    let customTemplates = JSON.parse(localStorage.getItem("customOutputTemplates") || "[]");

    if (editingTemplateId) {
      // Update existing custom template
      const index = customTemplates.findIndex(t => t.id == editingTemplateId);
      if (index !== -1) {
        customTemplates[index] = { ...customTemplates[index], name: templateName, html: templateCode };
        showToast("টেমপ্লেট সফলভাবে আপডেট হয়েছে!", "success");
      } else {
        // If it's a predefined template being edited, save as a new custom template
        const newTemplate = {
          id: Date.now(),
          name: templateName,
          description: "কাস্টম টেমপ্লেট",
          html: templateCode
        };
        customTemplates.push(newTemplate);
        showToast("প্রি-ডিফাইন্ড টেমপ্লেট কাস্টম হিসেবে সংরক্ষণ করা হয়েছে!", "success");
      }
    } else {
      // Add new custom template
      const newTemplate = {
        id: Date.now(),
        name: templateName,
        description: "কাস্টম টেমপ্লেট",
        html: templateCode
      };
      customTemplates.push(newTemplate);
      showToast("নতুন টেমপ্লেট সফলভাবে যোগ হয়েছে!", "success");
    }

    localStorage.setItem("customOutputTemplates", JSON.stringify(customTemplates));
    renderTemplates();
    closeTemplateModal();
  }

  function deleteTemplate(templateId) {
    if (confirm("আপনি কি নিশ্চিত এই টেমপ্লেটটি মুছে ফেলতে চান?")) {
      let customTemplates = JSON.parse(localStorage.getItem("customOutputTemplates") || "[]");
      customTemplates = customTemplates.filter(t => t.id != templateId);
      localStorage.setItem("customOutputTemplates", JSON.stringify(customTemplates));
      renderTemplates();
      showToast("টেমপ্লেট মুছে ফেলা হয়েছে।", "info");
    }
  }

  function applyTemplate(templateId) {
    localStorage.setItem("selectedOutputTemplate", templateId);
    showToast("টেমপ্লেট সফলভাবে প্রয়োগ করা হয়েছে!", "success");
    renderTemplates(); // Re-render to show active status
  }

  function openPreviewModal(templateHtml) {
    const modal = document.getElementById("templatePreviewModal");
    const iframe = document.getElementById("templatePreviewFrame");
    // Create a full HTML document for the iframe to render correctly
    const fullHtml = `
      <!DOCTYPE html>
      <html lang="bn">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Preview</title>
        <style>
          body { margin: 0; padding: 10px; font-family: sans-serif; background-color: #f0f2f5; color: #333; }
          /* Add any common styles that your templates might rely on */
        </style>
      </head>
      <body>
        ${templateHtml}
      </body>
      </html>
    `;
    iframe.srcdoc = fullHtml;
    modal.style.display = "flex";
  }

  function closePreviewModal() {
    document.getElementById("templatePreviewModal").style.display = "none";
    document.getElementById("templatePreviewFrame").srcdoc = ""; // Clear iframe content
  }

  function renderTemplates() {
    const templateGrid = document.getElementById("templateGrid");
    templateGrid.innerHTML = "";
    
    const predefinedTemplates = getOutputTemplates(); // From templates.js
    const customTemplates = JSON.parse(localStorage.getItem("customOutputTemplates") || "[]");
    const allTemplates = [...predefinedTemplates, ...customTemplates];

    const selectedTemplateId = localStorage.getItem("selectedOutputTemplate");

    if (allTemplates.length === 0) {
      templateGrid.innerHTML = "<p style=\"color:#ccc;text-align:center;padding:20px;\">কোনো টেমপ্লেট পাওয়া যায়নি। একটি নতুন টেমপ্লেট যোগ করুন।</p>";
      return;
    }

    allTemplates.forEach(template => {
      const card = document.createElement("div");
      card.className = "template-card";
      
      const isSelected = template.id == selectedTemplateId;
      card.style.border = isSelected ? "2px solid #00bfff" : "none";

      const isPredefined = predefinedTemplates.some(t => t.id === template.id);

      card.innerHTML = `
        <div class="template-preview">
          <iframe srcdoc="${template.html.replace(/"/g, '&quot;')}" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
        <div class="template-info">
          <h3>${template.name} ${isSelected ? 
            `<span style="font-size:12px;background:#00bfff;color:white;padding:3px 8px;border-radius:5px;margin-left:5px;">সক্রিয়</span>` : 
            ``}
          </h3>
          <p>${template.description || ''}</p>
          <div class="template-actions">
            <button class="apply-btn" onclick="applyTemplate('${template.id}')">প্রয়োগ করুন</button>
            <button class="preview-btn" onclick="openPreviewModal('${template.html.replace(/'/g, '\'').replace(/\n/g, '')}')">প্রিভিউ</button>
            ${!isPredefined ? `<button class="edit-btn" onclick="openTemplateModal('${template.id}')" style="background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%); color: white;">এডিট</button>` : ''}
            ${!isPredefined ? `<button class="delete-btn" onclick="deleteTemplate('${template.id}')" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white;">মুছুন</button>` : ''}
          </div>
        </div>
      `;
      templateGrid.appendChild(card);
    });
  }

  // Initial load
  window.addEventListener("DOMContentLoaded", () => {
    // Ensure showToast is available
    if (typeof showToast === 'undefined') {
      console.error('showToast function is not defined. Make sure script.js is loaded before templates.html script.');
      // Fallback or alert user
      window.showToast = (msg, type) => alert(msg);
    }
    renderTemplates();
  });
</script>


