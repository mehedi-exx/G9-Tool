<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - G9Tool</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>

  <div class="main-content">
    <h2>üì¶ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h2>

    <div class="admin-controls">
      <input type="text" id="searchInput" placeholder="üîç ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶® (‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶ï‡ßã‡¶°)" oninput="renderDrafts()" />
      
      <div class="control-buttons">
        <button onclick="exportDrafts()"><i class="fas fa-download"></i> Export JSON</button>
        <button onclick="document.getElementById('importFile').click()"><i class="fas fa-upload"></i> Import JSON</button>
        <button onclick="clearAllDrafts()" class="danger-btn"><i class="fas fa-trash-alt"></i> ‡¶∏‡¶¨ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <input type="file" id="importFile" accept=".json" onchange="importDrafts()" style="display: none;" />
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <h3 id="totalProducts">0</h3>
        <p>‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</p>
      </div>
      <div class="stat-card">
        <h3 id="todayProducts">0</h3>
        <p>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü</p>
      </div>
    </div>

    <div id="draftList"></div>
  </div>

  <script>
    function getDrafts() {
      return JSON.parse(localStorage.getItem("drafts") || "[]");
    }

    function saveDrafts(drafts) {
      localStorage.setItem("drafts", JSON.stringify(drafts));
    }

    function updateStats() {
      const drafts = getDrafts();
      const today = new Date().toDateString();
      const todayDrafts = drafts.filter(d => new Date(d.timestamp).toDateString() === today);
      
      document.getElementById("totalProducts").textContent = drafts.length;
      document.getElementById("todayProducts").textContent = todayDrafts.length;
    }

    function renderDrafts() {
      const drafts = getDrafts();
      const search = document.getElementById("searchInput").value.toLowerCase();
      const list = document.getElementById("draftList");
      list.innerHTML = "";

      const filtered = drafts.filter(d => 
        d.name.toLowerCase().includes(search) || 
        d.code.toLowerCase().includes(search) ||
        (d.category && d.category.toLowerCase().includes(search))
      );

      if (!filtered.length) {
        list.innerHTML = "<div class='no-data'>‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</div>";
        return;
      }

      filtered.forEach(d => {
        const div = document.createElement("div");
        div.className = "draft-item";
        div.innerHTML = `
          <div class="draft-header">
            <div class="draft-info">
              <div class="draft-name">üîñ ${d.name}</div>
              <div class="draft-meta">‡¶ï‡ßã‡¶°: ${d.code} | ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${d.price} | ${d.timestamp || 'N/A'}</div>
            </div>
            <div class="actions">
              <button onclick="editDraft(${d.id})" class="edit-btn"><i class="fas fa-edit"></i> Edit</button>
              <button onclick="duplicateDraft(${d.id})" class="duplicate-btn"><i class="fas fa-copy"></i> Duplicate</button>
              <button onclick="deleteDraft(${d.id})" class="delete-btn"><i class="fas fa-trash"></i> Delete</button>
              <button onclick="previewDraft(${d.id})" class="preview-btn"><i class="fas fa-eye"></i> Preview</button>
            </div>
          </div>
          <div class="preview" id="preview-${d.id}" style="display:none;"></div>
        `;
        list.appendChild(div);
      });
      
      updateStats();
    }

    function editDraft(id) {
      localStorage.setItem("editDraftId", id);
      window.location.href = "dashboard.html";
    }

    function duplicateDraft(id) {
      const drafts = getDrafts();
      const original = drafts.find(d => d.id === id);
      if (original) {
        const duplicate = {...original};
        duplicate.id = Date.now();
        duplicate.name = original.name + " (Copy)";
        duplicate.code = original.code + "_copy";
        duplicate.timestamp = new Date().toLocaleString('bn-BD');
        drafts.push(duplicate);
        saveDrafts(drafts);
        renderDrafts();
        alert("‚úÖ ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
      }
    }

    function deleteDraft(id) {
      if (confirm("‚ùå ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶∏‡¶§‡ßç‡¶Ø‡¶ø‡¶á ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
        const drafts = getDrafts().filter(d => d.id !== id);
        saveDrafts(drafts);
        renderDrafts();
        alert("‚úÖ ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
      }
    }

    function clearAllDrafts() {
      if (confirm("‚ö†Ô∏è ‡¶∏‡¶¨ ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º ‡¶´‡ßá‡¶∞‡¶æ‡¶®‡ßã ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
        localStorage.removeItem("drafts");
        renderDrafts();
        alert("‚úÖ ‡¶∏‡¶¨ ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
      }
    }

    function previewDraft(id) {
      const previewBox = document.getElementById("preview-" + id);
      if (previewBox.style.display === "block") {
        previewBox.style.display = "none";
        previewBox.innerHTML = "";
        return;
      }

      const drafts = getDrafts();
      const d = drafts.find(d => d.id === id);
      if (!d) return;

      const html = `
        <div class="preview-content">
          <div class="preview-row"><strong>‡¶®‡¶æ‡¶Æ:</strong> ${d.name}</div>
          <div class="preview-row"><strong>‡¶ï‡ßã‡¶°:</strong> ${d.code}</div>
          <div class="preview-row"><strong>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</strong> ‡ß≥${d.price}</div>
          ${d.offer ? `<div class="preview-row"><strong>‡¶Ö‡¶´‡¶æ‡¶∞:</strong> ‡ß≥${d.offer}</div>` : ''}
          ${d.brand ? `<div class="preview-row"><strong>‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°:</strong> ${d.brand}</div>` : ''}
          ${d.category ? `<div class="preview-row"><strong>‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø:</strong> ${d.category}</div>` : ''}
          <div class="preview-row"><strong>‡¶π‡ßã‡¶Ø‡¶º‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™:</strong> ${d.wa}</div>
          ${d.desc ? `<div class="preview-row"><strong>‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ:</strong> ${d.desc}</div>` : ''}
          ${d.images && d.images.length ? `<div class="preview-row"><strong>‡¶õ‡¶¨‡¶ø:</strong> ${d.images.length} ‡¶ü‡¶ø</div>` : ''}
        </div>
      `;
      previewBox.innerHTML = html;
      previewBox.style.display = "block";
    }

    function exportDrafts() {
      const data = getDrafts();
      if (!data.length) {
        alert("‚ùå ‡¶ï‡ßã‡¶®‡ßã ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶®‡ßá‡¶á");
        return;
      }
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `g9tool_drafts_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      alert("‚úÖ ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
    }

    function importDrafts() {
      const file = document.getElementById("importFile").files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (!Array.isArray(imported)) throw new Error("Invalid format");

          const existing = getDrafts();
          const merged = [...existing, ...imported.map(d => ({ 
            ...d, 
            id: Date.now() + Math.random(),
            timestamp: d.timestamp || new Date().toLocaleString('bn-BD')
          }))];
          saveDrafts(merged);
          alert(`‚úÖ ${imported.length} ‡¶ü‡¶ø ‡¶°‡ßç‡¶∞‡¶æ‡¶´‡¶ü ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤`);
          renderDrafts();
        } catch (e) {
          alert("‚ùå ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
      };
      reader.readAsText(file);
    }

    function checkLogin() {
      if (!localStorage.getItem("loggedInUser")) {
        window.location.replace("index.html");
      }
    }

    // Initial load
    window.addEventListener("DOMContentLoaded", () => {
      checkLogin();
      renderDrafts();
    });
  </script>

  <script>
    fetch("header.html")
      .then(response => response.text())
      .then(data => {
        document.body.insertAdjacentHTML("afterbegin", data);
      });
  </script>
</body>
</html>

