<!-- ‚úÖ admin.html: Full-featured version with Edit, Delete, Preview, WhatsApp, and Custom Data -->
<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel - G9Tool</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .admin-wrapper {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: #1c1c1c;
      border-radius: 12px;
    }
    .admin-wrapper h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .product-list {
      margin-top: 20px;
    }
    .product-item {
      background: #2a2a2a;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 8px;
    }
    .product-item h4 {
      margin: 0 0 5px;
    }
    .product-item small {
      color: #aaa;
    }
    .product-item .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .product-item button {
      flex: 1 1 auto;
      padding: 10px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      white-space: nowrap;
    }
    .edit-btn { background: #007bff; color: #fff; }
    .preview-btn { background: #17a2b8; color: #fff; }
    .delete-btn { background: #dc3545; color: #fff; }
    .top-controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
    }
    .top-controls button,
    .top-controls label span {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .top-controls button {
      background: #28a745;
      color: white;
      border: none;
    }
    .top-controls label span {
      background: #ffc107;
      color: black;
    }
    input[type="file"] {
      display: none;
    }
    @media (max-width: 500px) {
      .product-item .actions button {
        flex: 100%;
      }
    }
  </style>
</head>
<body>

<div class="admin-wrapper">
  <h2><i class="fas fa-database"></i> ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
  <div class="top-controls">
    <button onclick="exportProducts()"><i class="fas fa-download"></i> ‡¶è‡¶ï‡ßç‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü</button>
    <label>
      <input type="file" accept="application/json" onchange="importProducts(event)">
      <span><i class="fas fa-upload"></i> ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</span>
    </label>
  </div>

  <div class="product-list" id="productList"></div>
</div>

<script>
const user = localStorage.getItem("loggedInUser") || "guest";
const STORAGE_KEY = `g9_products_${user}`;

function loadProducts() {
  const list = document.getElementById("productList");
  list.innerHTML = "";
  const products = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  if (products.length === 0) {
    list.innerHTML = "<p style='text-align:center;color:#aaa;'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>";
    return;
  }

  products.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "product-item";
    div.innerHTML = `
      <h4>${item.name}</h4>
      <small>‡¶ï‡ßã‡¶°: ${item.code} | ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ${item.offer || item.price}‡ß≥</small>
      <div class="actions">
        <button class="edit-btn" onclick="editProduct(${index})"><i class='fas fa-edit'></i> ‡¶è‡¶°‡¶ø‡¶ü</button>
        <button class="preview-btn" onclick="previewProduct(${index})"><i class='fas fa-eye'></i> ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</button>
        <button class="delete-btn" onclick="deleteProduct(${index})"><i class='fas fa-trash'></i> ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function editProduct(index) {
  const products = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  const data = products[index];
  if (!data) return;
  localStorage.setItem("edit_product_index", index);
  localStorage.setItem("formDraft", JSON.stringify(data));
  window.location.href = "dashboard.html?edit=1";
}

function deleteProduct(index) {
  if (!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
  const products = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  products.splice(index, 1);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
  loadProducts();
}

function previewProduct(index) {
  const products = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  const item = products[index];
  if (!item) return;

  const discount = item.offer ? Math.round(((item.price - item.offer) / item.price) * 100) : 0;
  let html = `
  <div style="max-width:600px;margin:auto;font-family:sans-serif;text-align:center;">
    <h2>${item.name}</h2>
    ${item.imgs?.[0] ? `<img src="${item.imgs[0]}" style="max-width:100%;border-radius:10px;margin-bottom:10px;">` : ""}
    <p><strong>‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</strong> ${item.offer ? `<span style='text-decoration:line-through;'>${item.price}‡ß≥</span> <span style='color:red;font-weight:bold;'>${item.offer}‡ß≥</span> <small style='color:limegreen'>(-${discount}%)</small>` : `${item.price}‡ß≥`}</p>
    <p><strong>‡¶ï‡ßã‡¶°:</strong> ${item.code}</p>
    <p><strong>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</strong> ${item.status || "IN STOCK"}</p>
    <p><strong>‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø:</strong> ${item.delivery || "N/A"}</p>
    <p><strong>‡¶¨‡¶∞‡ßç‡¶£‡¶®‡¶æ:</strong><br> ${item.desc || "N/A"}</p>
    ${item.custom?.length ? `<ul style='text-align:left;max-width:500px;margin:auto;'>${item.custom.map(f => `<li>üîß ${f.key}: ${f.value}</li>`).join('')}</ul>` : ""}
    <p style="margin-top:20px;">
      <a href="https://wa.me/${item.wa}?text=üì¶ ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡¶£‡ßç‡¶Ø ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á%0Aüîñ ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü: ${item.name}%0Aüí∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ${item.offer || item.price}‡ß≥%0Aüßæ ‡¶ï‡ßã‡¶°: ${item.code}%0AüìÅ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø: ${item.category || 'N/A'}%0Aüöö ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø: ${item.delivery}" target="_blank" style="display:inline-block;padding:10px 20px;background:#25D366;color:white;border-radius:6px;text-decoration:none;font-weight:bold;">
        <i class="fab fa-whatsapp"></i> WhatsApp ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
      </a>
    </p>
  </div>`;

  const win = window.open("", "_blank");
  win.document.write(`<!DOCTYPE html><html><head><meta charset='UTF-8'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title>Preview</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css'></head><body style='background:#f9f9f9;margin:0;padding:20px;'>${html}</body></html>`);
}

function exportProducts() {
  const data = localStorage.getItem(STORAGE_KEY);
  const blob = new Blob([data], {type: "application/json"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `${user}_products.json`;
  link.click();
}

function importProducts(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (!Array.isArray(imported)) throw new Error("Invalid format");
      localStorage.setItem(STORAGE_KEY, JSON.stringify(imported));
      alert("‚úÖ ‡¶°‡ßá‡¶ü‡¶æ ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá");
      loadProducts();
    } catch {
      alert("‚ùå ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶®‡¶Ø‡¶º");
    }
  };
  reader.readAsText(file);
}

window.onload = loadProducts;
</script>

</body>
</html>
