<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>G9Tool Admin Panel</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    .admin-wrapper {
      max-width: 900px;
      margin: 40px auto;
      background: #1c1c1c;
      padding: 20px;
      border-radius: 12px;
      color: white;
    }
    .product-item {
      background: #2a2a2a;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .product-item h3 {
      margin-bottom: 5px;
      font-size: 18px;
      color: #00cc44;
    }
    .product-item small {
      color: #ccc;
    }
    .product-item button {
      margin-right: 10px;
      margin-top: 10px;
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    .product-item button.edit {
      background-color: #007bff;
      color: white;
    }
    .product-item button.edit:hover {
      background-color: #0056b3;
    }
    .product-item button.delete {
      background-color: #dc3545;
      color: white;
    }
    .product-item button.delete:hover {
      background-color: #a71d2a;
    }
    .top-actions {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .top-actions button, .top-actions label span {
      background: #28a745;
      color: white;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      display: inline-block;
      user-select: none;
    }
    .top-actions button:hover, .top-actions label span:hover {
      background: #1e7e34;
    }
    .top-actions label {
      cursor: pointer;
      display: inline-block;
    }
    input[type="file"] {
      display: none;
    }
    p.no-products {
      text-align: center;
      margin-top: 30px;
      font-size: 18px;
      color: #888;
    }
  </style>
</head>
<body>

<header class="header">
  <div class="left-icons">
    <button class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
    <div class="logo"><i class="fas fa-cogs"></i> G9Tool Admin Panel</div>
  </div>
  <a href="https://t.me/G9tool" class="telegram-icon" target="_blank">
    <i class="fab fa-telegram-plane"></i>
  </a>
</header>

<main>
  <div class="admin-wrapper">
    <div class="top-actions">
      <button onclick="exportData()"><i class="fas fa-download"></i> Export</button>
      <label>
        <span><i class="fas fa-upload"></i> Import</span>
        <input type="file" accept=".json" onchange="importData(event)" />
      </label>
    </div>

    <div id="productList"></div>
  </div>
</main>

<!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <button class="close-sidebar" onclick="toggleMenu()"><i class="fas fa-times"></i></button>
  <a href="dashboard.html"><i class="fas fa-home"></i> ‡¶π‡ßã‡¶Æ</a>
  <a href="menu/about.html"><i class="fas fa-info-circle"></i> ‡¶è‡¶¨‡¶æ‡¶â‡¶ü</a>
  <a href="menu/contact.html"><i class="fas fa-phone"></i> ‡¶ï‡¶®‡ßç‡¶ü‡¶æ‡¶ï‡ßç‡¶ü</a>
  <a href="menu/privacy.html"><i class="fas fa-user-shield"></i> ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø</a>
  <a href="admin.html" class="active"><i class="fas fa-cogs"></i> ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</a>
  <a href="index.html" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a>
</div>

<script>
  // Toggle Sidebar
  function toggleMenu() {
    document.getElementById("sidebar").classList.toggle("active");
  }

  // Logout user and redirect
  function logout() {
    localStorage.removeItem("loggedInUser");
    window.location.href = "index.html";
  }

  // Get logged in user
  const uname = localStorage.getItem("loggedInUser");
  if (!uname) {
    alert("‚ö†Ô∏è ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
    window.location.href = "index.html";
  }

  // Load all data and user specific data
  const allData = JSON.parse(localStorage.getItem("g9tool_data") || "{}");
  let userData = allData[uname] || [];

  // Render product list on admin page
  function renderList() {
    const list = document.getElementById("productList");
    list.innerHTML = "";

    if (!userData.length) {
      list.innerHTML = "<p class='no-products'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶®‡ßá‡¶á!</p>";
      return;
    }

    userData.forEach((item, i) => {
      list.innerHTML += `
        <div class="product-item">
          <h3>${item.name || "Unnamed Product"}</h3>
          <small>üì¶ ‡¶ï‡ßã‡¶°: ${item.code || "N/A"}</small><br>
          <small>üí∞ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø: ‡ß≥${item.offer || item.price}</small><br>
          <button class="edit" onclick="editProduct(${i})"><i class="fas fa-edit"></i> Edit</button>
          <button class="delete" onclick="deleteProduct(${i})"><i class="fas fa-trash-alt"></i> Delete</button>
        </div>
      `;
    });
  }

  // Edit product: redirect to dashboard with edit index
  function editProduct(index) {
    window.location.href = `dashboard.html?edit=${index}`;
  }

  // Delete product with confirmation
  function deleteProduct(index) {
    if (!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) return;
    userData.splice(index, 1);
    allData[uname] = userData;
    localStorage.setItem("g9tool_data", JSON.stringify(allData));
    renderList();
  }

  // Export user products as JSON file
  function exportData() {
    const dataStr = JSON.stringify(userData, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = `${uname}_products.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  // Import products JSON file and update storage
  function importData(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      try {
        const imported = JSON.parse(reader.result);
        if (!Array.isArray(imported)) throw new Error("Invalid JSON format");
        userData = imported;
        allData[uname] = userData;
        localStorage.setItem("g9tool_data", JSON.stringify(allData));
        renderList();
        alert("‚úÖ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      } catch (e) {
        alert("‡¶á‡¶Æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + e.message);
      }
    };
    reader.readAsText(file);
  }

  // Initial render
  renderList();
</script>

</body>
</html>
